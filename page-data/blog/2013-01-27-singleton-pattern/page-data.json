{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2013-01-27-singleton-pattern/","result":{"data":{"markdownRemark":{"html":"<p style=\"background:white;\"><span style=\"color:#ff9900;font-family:Segoe UI;font-size:15pt;\"><strong>Singleton&nbsp;Pattern<br/>\n</strong></span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">Well, to begin with,&nbsp;<strong>Singleton</strong>&nbsp;is one of the most commonly used - as well as misused - design patterns. Why did I say misused? You will get the answer as you read on.<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\"><strong>Singleton</strong>&nbsp;Pattern is usually used to restrict the instances of a class, that is the objects within the life cycle of the software program to one. But why do we need to use&nbsp;<strong>Singleton</strong>s? We use them:<br/>\n</span></p>\n<ul><li>\n<div style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">to coordinate actions across the system<br/>\n</span></div>\n</li><li>\n<div style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">to improve upon the efficiency of the system<br/>\n</span></div>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">Care should be taken to identify the need &amp; benefits of using a&nbsp;<strong>singleton</strong>. Often, we tend to use&nbsp;<strong>singleton</strong>s to hide a global object.<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#ff9900;font-family:Segoe UI;font-size:15pt;\"><strong>How to Create a&nbsp;Singleton?<br/>\n</strong></span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">Most of us know how to create a&nbsp;<strong>singleton</strong>. We have done it so many times by now, isn't it? But let us just do a quick recap.<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">The thumb rule for&nbsp;<strong>singleton</strong>s is that the direct instantiation through the constructor should be prevented. Then how do we instantiate or access the object? The solution is to provide a method that creates a new instance of the object if one does not exist. If an instance already exists, it simply returns a reference to that object.<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">class</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong> {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>() {<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">};<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">Remember the default access in a C++ class is&nbsp;</span><span style=\"color:#990000;font-family:Consolas;\">private</span><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">. </span><span style=\"color:black;font-family:Consolas;font-size:9pt;\"><br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">Now that we have prevented the direct instantiation of the class, we need to provide a mechanism to access the object. Here is how we do this:<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">class</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong> {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">public</span><span style=\"color:black;\">:<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>* getInstance() {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">if</span><span style=\"color:black;\"> (NULL == _instance) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_instance = </span><span style=\"color:blue;\">new</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>();<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">return</span><span style=\"color:black;\"> _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">private</span><span style=\"color:black;\">:<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// default constructor<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>() {<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// the single instance of the object<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>* _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">};<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\"><strong>Singleton</strong>* <strong>Singleton</strong>::_instance = NULL;<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">Now we have ensured that only one instance exists and gives access to the same. Now other required functionality can be added to the&nbsp;<strong>Singleton</strong>&nbsp;class.<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#ff9900;font-family:Segoe UI;font-size:15pt;\"><strong>Is That All?<br/>\n</strong></span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">Are we done? No, not quite exactly. Remember I had said that this is an attempt to create a perfect&nbsp;<strong>Singleton</strong>. So what is wrong with the above? Have we missed something? Yes, we did. Though we have prevented the direct instantiation, an object can still be created. If you recollect the basics, all C++ classes, apart from having their default constructors also have:<br/>\n</span></p>\n</li><li>\n<div style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">copy constructor<br/>\n</span></div>\n</li><li>\n<div style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">assignment operator<br/>\n</span></div>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">We need to declare these also as&nbsp;</span><span style=\"color:#990000;font-family:Consolas;\">private&nbsp;</span><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">so as to prevent the access. You may ask why. We do so because:<br/>\n</span></p>\n</li><li>\n<div style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">a copy constructor will create a new object from the existing one. But we are interested in limiting the instance to only one.<br/>\n</span></div>\n</li><li>\n<div style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">an assignment operator is not required for a&nbsp;<strong>Singleton</strong>; '_instance' is the only data member &amp; has to point to the same object across all instances.<br/>\n</span></div>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">class</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong> {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">public</span><span style=\"color:black;\">:<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>* getInstance() {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">if</span><span style=\"color:black;\"> (NULL == _instance) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_instance = </span><span style=\"color:blue;\">new</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>();<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">return</span><span style=\"color:black;\"> _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">private</span><span style=\"color:black;\">:<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// default constructor<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>() {<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// copy constructor<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>(</span><span style=\"color:blue;\">const</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>&amp;) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// assignment operator<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>&amp; operator=(</span><span style=\"color:blue;\">const</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>&amp;) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">return</span><span style=\"color:black;\"> *</span><span style=\"color:blue;\">this</span><span style=\"color:black;\">;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// the single instance of the object<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>* _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">};<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\"><strong>Singleton</strong>* <strong>Singleton</strong>::_instance = NULL;<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#ff9900;font-family:Segoe UI;font-size:15pt;\"><strong>How Do We Release the&nbsp;Singleton?<br/>\n</strong></span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">Now we have prevented alternatives to create another instance of the class. But what about the destruction of the instance? Can we define a destructor &amp; delete&nbsp;</span><span style=\"color:#990000;font-family:Consolas;\">_instance&nbsp;</span><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">in it? This though looks very simple enough, it isn't. If you do the above, you will have your code as:<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">class</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong> {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">public</span><span style=\"color:black;\">:<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">. . .<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">. . .<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;~<strong>Singleton</strong>() {<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">delete</span><span style=\"color:black;\"> _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">};<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">What actually happens in that destructor, is that delete&nbsp;</span><span style=\"color:#990000;font-family:Consolas;\">_instance&nbsp;</span><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">invokes the destructor again &amp; puts it into an infinite loop. So the easy way out seems to be to depend on the post program termination clean-up to release the memory. But then it is not a good practice to depend on the post program termination clean up for the new that we had done. Hence I recommend to have a&nbsp;</span><span style=\"color:#990000;font-family:Consolas;\">releaseInstance()</span><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">&nbsp;and to prevent access to the default destructor by making it&nbsp;</span><span style=\"color:#990000;font-family:Consolas;\">private</span><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">.<br/>\n</span></p>\n<p style=\"text-align:right;background:white;\"><img alt=\"\" src=\"{{ site.baseurl }}/assets/012613_2002_singletonpa1.gif\"/><span style=\"color:#005782;font-family:Segoe UI;font-size:8pt;\"><br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">class</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong> {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">public</span><span style=\"color:black;\">:<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>* getInstance() {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">if</span><span style=\"color:black;\"> (NULL == _instance) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_instance = </span><span style=\"color:blue;\">new</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>();<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">return</span><span style=\"color:black;\"> _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n</span><span style=\"color:blue;\">void</span><span style=\"color:black;\"> releaseInstance() {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">if</span><span style=\"color:black;\"> (NULL != _instance) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">delete</span><span style=\"color:black;\"> _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_instance = NULL;<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">private</span><span style=\"color:black;\">:<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// default constructor<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>() {<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// default destructor<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;~<strong>Singleton</strong>() {<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// copy constructor<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>(</span><span style=\"color:blue;\">const</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>&amp;) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// assignment operator<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>&amp; operator=(</span><span style=\"color:blue;\">const</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>&amp;) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">return</span><span style=\"color:black;\"> *</span><span style=\"color:blue;\">this</span><span style=\"color:black;\">;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// the single instance of the object<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>* _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">};<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\"><strong>Singleton</strong>* <strong>Singleton</strong>::_instance = NULL;<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#ff9900;font-family:Segoe UI;font-size:15pt;\"><strong>Tune the Release of&nbsp;Singleton<br/>\n</strong></span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">Now that looks perfect. All said &amp; done, there still is a catch. When should&nbsp;</span><span style=\"color:#990000;font-family:Consolas;\">releaseInstance()</span><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">&nbsp;be called? Ideally, this should be called when the application exits. But in a real time situation when there are multiple developers working on the application code, it just remains a mirage. So what do we do? We will use a reference count to ensure that the actual destruction of the&nbsp;<strong>Singleton</strong>&nbsp;happens only when it is not being referenced anymore. So we add a&nbsp;</span><span style=\"color:#990000;font-family:Consolas;\">static&nbsp;</span><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">reference count to the&nbsp;<strong>Singleton</strong>.<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">class</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong> {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">public</span><span style=\"color:black;\">:<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>* getInstance() {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">if</span><span style=\"color:black;\"> (NULL == _instance) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_instance = </span><span style=\"color:blue;\">new</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>();<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_referenceCount++;<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">return</span><span style=\"color:black;\"> _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n</span><span style=\"color:blue;\">void</span><span style=\"color:black;\"> releaseInstance() {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_referenceCount--;<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">if</span><span style=\"color:black;\"> ((</span><span style=\"color:navy;\">0</span><span style=\"color:black;\"> == _referenceCount) &amp;&amp; (NULL != _instance)) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">delete</span><span style=\"color:black;\"> _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_instance = NULL;<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">private</span><span style=\"color:black;\">:<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// default constructor<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>() {<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// default destructor<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;~<strong>Singleton</strong>() {<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// copy constructor<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>(</span><span style=\"color:blue;\">const</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>&amp;) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// assignment operator<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;<strong>Singleton</strong>&amp; operator=(</span><span style=\"color:blue;\">const</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>&amp;) {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">return</span><span style=\"color:black;\"> *</span><span style=\"color:blue;\">this</span><span style=\"color:black;\">;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// the single instance of the object<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>* _instance;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:green;\"><em>// the count of references<br/>\n</em></span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">static</span><span style=\"color:black;\"><br/>\n</span><span style=\"color:blue;\">int</span><span style=\"color:black;\"> _referenceCount;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">};<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">int</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong>::_referenceCount = </span><span style=\"color:navy;\">0</span><span style=\"color:black;\">;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\"><strong>Singleton</strong>* <strong>Singleton</strong>::_instance = NULL;<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">This is much better, but still not completely foolproof. If the&nbsp;</span><span style=\"color:#990000;font-family:Consolas;\">releaseInstance()</span><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">&nbsp;is called more than required by one particular user, it will lead to a situation where an instance is deleted even though it is actually still very much in use. On the contrary, if the&nbsp;</span><span style=\"color:#990000;font-family:Consolas;\">releaseInstance()</span><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">&nbsp;is not called by a user, then the&nbsp;<strong>Singleton</strong>&nbsp;will never be deleted &amp; we are back to depending on the post program termination clean up.<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">In case of Java, as far as my knowledge goes, garbage collection takes care of releasing the instance when it is not referenced anymore. So not much problem as envisaged above for C++.<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#ff9900;font-family:Segoe UI;font-size:15pt;\"><strong>Finale<br/>\n</strong></span></p>\n<p style=\"background:white;\"><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;\">A simple way to handle the limitations in C++ is through effective code review. But the risk still remains as it is directly proportionate to the effectiveness of the code review. Though there is another workaround to minimize this risk, there always seems to be a way to hack through.<br/>\n</span></p>\n<p style=\"background:white;\"><span style=\"color:#ff9900;font-family:Segoe UI;font-size:15pt;\"><strong>Destruction:<br/>\n</strong></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">class</span><span style=\"color:black;\"><br/>\n<strong>Singleton</strong> {<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:blue;\">public</span><span style=\"color:black;\">:<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">. . .<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">. . .<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;~<strong>Singleton</strong>() {<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( _instance != NULL ) {<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Singleton* tmpPtr = _instance ;<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_instance = NULL ;<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"font-family:Consolas;font-size:9pt;\"><span style=\"color:black;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"color:blue;\">delete</span><span style=\"color:black;\"> tmpPtr ;<br/>\n</span></span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">&nbsp;&nbsp;&nbsp;&nbsp;}<br/>\n</span></p>\n<p style=\"background:#fbedbb;\"><span style=\"color:black;font-family:Consolas;font-size:9pt;\">};<br/>\n</span></p>\n<p><span style=\"color:#111111;font-family:Segoe UI;font-size:10pt;background-color:white;\">On the 2nd call to ~Singleton, _instance will be null, so it won't get stuck in the infinite loop. Then, you don't need the ReleaseInstance function</span></p></li></ul>","excerpt":"","frontmatter":{"date":"26 January, 2013","path":"/blog/2013-01-27-singleton-pattern/","title":"Singleton Pattern"},"fields":{"readingTime":{"text":"10 min read"}}}},"pageContext":{}},"staticQueryHashes":["3649515864","63159454"]}