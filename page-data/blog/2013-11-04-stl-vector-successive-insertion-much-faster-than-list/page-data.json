{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2013-11-04-stl-vector-successive-insertion-much-faster-than-list/","result":{"data":{"markdownRemark":{"html":"<p>I always thought that because of the reallocation vectors need to do as they grow in size, successively adding elements to one would be slower than doing the same to a list. But apparently that’s far from true. Successively adding elements to a vector takes much less time than doing the same to a list:</p>\n<div id=\"codeSnippetWrapper\">\n<div id=\"codeSnippet\" style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\">\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum1\" style=\"color:#606060;\">   1:</span> <span style=\"color:#008000;\">//vec.cpp</span></pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum2\" style=\"color:#606060;\">   2:</span> <span style=\"color:#cc6633;\">#include</span> &lt;vector&gt;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum3\" style=\"color:#606060;\">   3:</span> <span style=\"color:#0000ff;\">using</span> <span style=\"color:#0000ff;\">namespace</span> std;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum4\" style=\"color:#606060;\">   4:</span></pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum5\" style=\"color:#606060;\">   5:</span> <span style=\"color:#0000ff;\">int</span> main()</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum6\" style=\"color:#606060;\">   6:</span> {</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum7\" style=\"color:#606060;\">   7:</span>   vector&lt;<span style=\"color:#0000ff;\">int</span>&gt; vec;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum8\" style=\"color:#606060;\">   8:</span>   <span style=\"color:#0000ff;\">for</span>(<span style=\"color:#0000ff;\">int</span> i = 0;i &lt; 100000000;++i)</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum9\" style=\"color:#606060;\">   9:</span>     vec.push_back(i);</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum10\" style=\"color:#606060;\">  10:</span>   <span style=\"color:#0000ff;\">return</span> 0;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum11\" style=\"color:#606060;\">  11:</span> }</pre>\n<p><!--CRLF--></p>\n</div>\n</div>\n<div id=\"codeSnippetWrapper\">\n<div id=\"codeSnippet\" style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\">\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum1\" style=\"color:#606060;\">   1:</span> <span style=\"color:#008000;\">//lst.cpp</span></pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum2\" style=\"color:#606060;\">   2:</span> <span style=\"color:#cc6633;\">#include</span> &lt;list&gt;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum3\" style=\"color:#606060;\">   3:</span> <span style=\"color:#0000ff;\">using</span> <span style=\"color:#0000ff;\">namespace</span> std;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum4\" style=\"color:#606060;\">   4:</span></pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum5\" style=\"color:#606060;\">   5:</span> <span style=\"color:#0000ff;\">int</span> main()</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum6\" style=\"color:#606060;\">   6:</span> {</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum7\" style=\"color:#606060;\">   7:</span>   list&lt;<span style=\"color:#0000ff;\">int</span>&gt; lst;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum8\" style=\"color:#606060;\">   8:</span>   <span style=\"color:#0000ff;\">for</span>(<span style=\"color:#0000ff;\">int</span> i = 0;i &lt; 100000000;++i)</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum9\" style=\"color:#606060;\">   9:</span>     lst.push_back(i);</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum10\" style=\"color:#606060;\">  10:</span>   <span style=\"color:#0000ff;\">return</span> 0;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum11\" style=\"color:#606060;\">  11:</span> }</pre>\n<p><!--CRLF--></p>\n</div>\n</div>\n<p>The list code runs in around 19 seconds. The vector code? Less than 3 seconds - over 6 times faster. I suppose that’s because batch allocation of ints runs much faster than allocating linked list nodes one by one by one.</p>\n<p>Note: of course, because we know ahead of time exactly how many elements we need, the vector code can be optimized even further to allocate the right number of elements to begin with:</p>\n<div id=\"codeSnippetWrapper\">\n<div id=\"codeSnippet\" style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\">\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum1\" style=\"color:#606060;\">   1:</span> <span style=\"color:#cc6633;\">#include</span> &lt;vector&gt;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum2\" style=\"color:#606060;\">   2:</span> <span style=\"color:#0000ff;\">using</span> <span style=\"color:#0000ff;\">namespace</span> std;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum3\" style=\"color:#606060;\">   3:</span></pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum4\" style=\"color:#606060;\">   4:</span> <span style=\"color:#0000ff;\">int</span> main()</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum5\" style=\"color:#606060;\">   5:</span> {</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum6\" style=\"color:#606060;\">   6:</span>   vector&lt;<span style=\"color:#0000ff;\">int</span>&gt; vec(100000000);</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum7\" style=\"color:#606060;\">   7:</span>   <span style=\"color:#0000ff;\">for</span>(<span style=\"color:#0000ff;\">int</span> i = 0;i &lt; vec.size();++i)</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum8\" style=\"color:#606060;\">   8:</span>     vec[i] = i;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum9\" style=\"color:#606060;\">   9:</span>   <span style=\"color:#0000ff;\">return</span> 0;</pre>\n<p><!--CRLF--></p>\n<pre style=\"text-align:left;line-height:12pt;background-color:#f4f4f4;margin:0;width:100%;font-family:'Courier New', courier, monospace;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;\"><span id=\"lnum10\" style=\"color:#606060;\">  10:</span> }</pre>\n<p><!--CRLF--></p>\n</div>\n</div>\n<p>…which runs in less than 1.5 seconds.</p>\n<p>Note: it was brought to my attention that for larger data structures (ie, things larger than ints), the vector’s advantage will begin to degrade as the reallocation and copying begin to take more time.</p>","excerpt":"I always thought that because of the reallocation vectors need to do as they grow in size, successively adding elements to one would be slower than doing the…","frontmatter":{"date":"04 November, 2013","path":"/blog/2013-11-04-stl-vector-successive-insertion-much-faster-than-list/","title":"[STL] Vector successive insertion much faster than list"},"fields":{"readingTime":{"text":"3 min read"}}}},"pageContext":{}},"staticQueryHashes":["3649515864","63159454"]}